<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Test | HomePathways</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0A0F1D] text-gray-200">
    <div class="max-w-xl mx-auto py-20 px-6">
        <div id="quiz-container" class="bg-slate-900 border border-slate-800 p-10 rounded-3xl shadow-2xl">
            <div id="question-area">
                <h2 id="q-text" class="text-2xl font-bold mb-6">Ready to test the GHL Connection?</h2>
                <button onclick="startTest()" class="bg-amber-400 text-black font-bold px-8 py-4 rounded-xl">Start 5-Question Test</button>
            </div>
        </div>
    </div>

    <script>
        const testQuestions = [
            { q: "Test 1: Emotional Why?", cat: "c1" },
            { q: "Test 2: Cost of Inaction?", cat: "c2" },
            { q: "Test 3: Logical Foundation?", cat: "c3" },
            { q: "Test 4: Identity & Status?", cat: "c4" },
            { q: "Test 5: Future-Self?", cat: "c5" }
        ];
        let current = 0;
        let scores = { c1:4, c2:4, c3:4, c4:4, c5:4 };

        function startTest() {
            renderQ();
        }

        function renderQ() {
            const q = testQuestions[current];
            document.getElementById('question-area').innerHTML = `
                <p class="text-amber-400 mb-2">Question ${current + 1} of 5</p>
                <h2 class="text-2xl font-bold mb-8">${q.q}</h2>
                <button onclick="next()" class="w-full text-left p-4 border border-slate-700 rounded-xl hover:bg-slate-800 mb-4">Click to answer</button>
            `;
        }

        function next() {
            current++;
            if (current < 5) { renderQ(); } 
            else { showEmail(); }
        }

        function showEmail() {
            document.getElementById('question-area').innerHTML = `
                <h2 class="text-2xl font-bold mb-4">Almost there...</h2>
                <input type="email" id="testEmail" placeholder="Your Email" class="w-full p-4 rounded-xl bg-black border border-slate-700 mb-4 text-white">
                <button onclick="fireWebhook()" id="submitBtn" class="w-full bg-amber-400 text-black font-bold py-4 rounded-xl">SEND SIGNAL TO GHL</button>
            `;
        }

        async function fireWebhook() {
            const email = document.getElementById('testEmail').value;
            const btn = document.getElementById('submitBtn');
            btn.innerText = "SENDING...";
            btn.disabled = true;

            // --- PASTE YOUR URL BELOW ---
            const webhookUrl = "https://services.leadconnectorhq.com/hooks/WigtheaBiF6HeC2gHv8c/webhook-trigger/9cc72b12-ecc6-40dc-b7e3-f5d0c428fcea";

            const data = { email: email, persona: "test-run", c1:4, c2:4, c3:4, c4:4, c5:4 };

            // We use 'fetch' but without 'no-cors' so we can see if it actually works
            try {
                await fetch(webhookUrl, {
                    method: "POST",
                    body: JSON.stringify(data),
                    headers: { "Content-Type": "application/json" }
                });
            } catch (e) {
                console.log("Fetch attempted");
            }

            // WE WAIT 3 SECONDS MANUALLY TO ENSURE GHL CATCHES IT
            btn.innerText = "SIGNAL FIRED! REDIRECTING...";
            setTimeout(() => {
                window.location.href = `report.html?email=${email}&c1=4&c2=4&c3=4&c4=4&c5=4`;
            }, 3000);
        }
    </script>
</body>
</html>